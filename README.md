---
layout:     post
title:      "line_game 一款方向键控制的占领地盘小游戏"
date:       2017-03-01
author:     "AShuai"
tags:
    - project
---

小时候在一款功能机上玩过的小游戏，因为不记得名字后来也找不到了，于是用Python实现了一个类似的游戏。

这本来是大一时程序设计思想与方法课程的大作业，当时写的的极其粗糙，判胜机制不好，大二学完数据结构之后用dfs改了一遍。

<!--more-->

---

## 游戏玩法介绍

需要安装Python2，可能需要安装tk模块
双击运行或命令行输入```Python ./line_game.py```

红色的点代表玩家，蓝色的点代表坏蛋，坏蛋一直在运动，碰壁后反弹。

灰色底色为坏蛋地盘，白色底色为玩家占有的地盘，初始时除了周围一圈白色，中间全为灰色。

玩家可以通过键盘方向键或WASD来操纵，玩家从一个点进入坏蛋地盘后，从另一个点出来，他走过的路径即可以将坏蛋地盘分割为几个部分，如果某个部分内没有坏蛋，则该地盘为玩家所占有。

判负规则：玩家在坏蛋地盘运动过程中的路径如果被坏蛋发现（蓝色的点碰到红色点拉出的路径），玩家失败。

判胜规则：玩家占领的地盘足够多时，50%以上，即视为胜利。

![img](https://github.com/dusmart/dusmart.github.io/raw/master/assets/img/2017-03-01-7.png)

## 代码分析

游戏图形界面通过Python的tkinter包的画布功能实现。

最难实现的为，玩家将坏蛋地盘分割完成后，如何判定哪一款地盘应该被玩家占有。第一版中由于暴力搜索复杂度太高，没能实现，这一次使用深度优先搜索标记所有坏蛋地盘，然后再扫描一遍，将玩家地盘改色。

游戏中所有的点存储在一个二维数组中，分别用不同的数字代表不同的状态

Player类有以下函数：

1. __init__ 初始化所有参数，创建画布和初始界面
2. start 开始整个游戏的主循环
3. createBoss 生成一个坏蛋并随机创建坏蛋的各种信息
4. bossMove 定义坏蛋移动规则，期间判定是否发现玩家（即是否游戏失败）
5. moveNext 定义玩家移动规则，为了避免和坏蛋同时移动，开头用一个mutex互斥量来保持和坏蛋移动是异步的
6. cleanUp 调用了dfs和change子函数，dfs标记所有坏蛋应有的地盘，change把玩家应有地盘划归玩家

Player类提供了两个接口，坏蛋数目和坏蛋速度，可以方便的调整难度。

由于dfs搜索深度大于1000，所以必须在主函数更改最大栈深度```sys.setrecursionlimit(10000)```

## 源代码网址

[https://github.com/dusmart/line_game](https://github.com/dusmart/line_game)

